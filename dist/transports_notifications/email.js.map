{"version":3,"file":"email.js","names":["nodemailer","require","Email","constructor","options","queueTimeout","nodemailerOptions","from","to","subject","text","blockOnErrorTimeout","mock","name","transporter","createTransport","send","notification","process","log_level","timestamp","env","serverIp","message","sendMail","JSON","stringify","error","console","exports","default"],"sources":["../../src/transports_notifications/email.js"],"sourcesContent":["const nodemailer = require(\"nodemailer\");\n\nexport default class Email {\n  constructor(options) {\n    const {\n      queueTimeout = 1000,\n      nodemailerOptions,\n      from,\n      to,\n      subject = `Alarm notification`,\n      text = `Hi,\n      Informing you on new alarm event, occured in your app.`,\n      blockOnErrorTimeout = 1000 * 60 * 60,\n      mock = \"\"\n    } = options;\n    this.name = \"email\";\n    this.from = from;\n    this.subject = subject;\n    this.queueTimeout = queueTimeout;\n    this.transporter = nodemailer.createTransport(nodemailerOptions);\n    this.subject = options.subject || `Alarm notification`;\n    this.text = text;\n    this.to = to;\n    this.blockOnErrorTimeout = blockOnErrorTimeout;\n    this.mock = mock;\n  }\n\n  async send(notification) {\n    try {\n      const { process, log_level, timestamp, env, serverIp, message } =\n        notification;\n      if (this.mock) return this.mock;\n      await this.transporter.sendMail({\n        from: this.from,\n        to: this.to,\n        subject: this.subject,\n        text: `${this.text}\n\n        Timestamp: ${timestamp}\n        Process: ${process}\n        Level: ${log_level}\n        NODE_ENV: ${env}\n        Server IP: ${serverIp}\n\n        Message:\n        ${\n          typeof message === \"string\"\n            ? message\n            : JSON.stringify(message, null, 2)\n        }\n        `\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n    }\n  }\n}\n"],"mappings":"2EAAA,MAAMA,UAAU,GAAGC,OAAO,CAAC,YAAY,CAAC;;AAEzB,MAAMC,KAAK,CAAC;EACzBC,WAAWA,CAACC,OAAO,EAAE;IACnB,MAAM;MACJC,YAAY,GAAG,IAAI;MACnBC,iBAAiB;MACjBC,IAAI;MACJC,EAAE;MACFC,OAAO,GAAI,oBAAmB;MAC9BC,IAAI,GAAI;AACd,6DAA6D;MACvDC,mBAAmB,GAAG,IAAI,GAAG,EAAE,GAAG,EAAE;MACpCC,IAAI,GAAG;IACT,CAAC,GAAGR,OAAO;IACX,IAAI,CAACS,IAAI,GAAG,OAAO;IACnB,IAAI,CAACN,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACE,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACJ,YAAY,GAAGA,YAAY;IAChC,IAAI,CAACS,WAAW,GAAGd,UAAU,CAACe,eAAe,CAACT,iBAAiB,CAAC;IAChE,IAAI,CAACG,OAAO,GAAGL,OAAO,CAACK,OAAO,IAAK,oBAAmB;IACtD,IAAI,CAACC,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACF,EAAE,GAAGA,EAAE;IACZ,IAAI,CAACG,mBAAmB,GAAGA,mBAAmB;IAC9C,IAAI,CAACC,IAAI,GAAGA,IAAI;EAClB;;EAEA,MAAMI,IAAIA,CAACC,YAAY,EAAE;IACvB,IAAI;MACF,MAAM,EAAEC,OAAO,EAAEC,SAAS,EAAEC,SAAS,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,OAAO,CAAC,CAAC;MAC7DN,YAAY;MACd,IAAI,IAAI,CAACL,IAAI,EAAE,OAAO,IAAI,CAACA,IAAI;MAC/B,MAAM,IAAI,CAACE,WAAW,CAACU,QAAQ,CAAC;QAC9BjB,IAAI,EAAE,IAAI,CAACA,IAAI;QACfC,EAAE,EAAE,IAAI,CAACA,EAAE;QACXC,OAAO,EAAE,IAAI,CAACA,OAAO;QACrBC,IAAI,EAAG,GAAE,IAAI,CAACA,IAAK;AAC3B;AACA,qBAAqBU,SAAU;AAC/B,mBAAmBF,OAAQ;AAC3B,iBAAiBC,SAAU;AAC3B,oBAAoBE,GAAI;AACxB,qBAAqBC,QAAS;AAC9B;AACA;AACA;QACU,OAAOC,OAAO,KAAK,QAAQ;QACvBA,OAAO;QACPE,IAAI,CAACC,SAAS,CAACH,OAAO,EAAE,IAAI,EAAE,CAAC;QACpC;AACT;MACM,CAAC,CAAC;MACF,OAAO,IAAI;IACb,CAAC,CAAC,OAAOI,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACtB;EACF;AACF,CAACE,OAAA,CAAAC,OAAA,GAvDoB5B,KAAK"}