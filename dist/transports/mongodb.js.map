{"version":3,"file":"mongodb.js","names":["_winstonTransport","require","_winstonTransport2","_interopRequireDefault","_mongodb","obj","__esModule","default","module","exports","MongoTransport","Transport","constructor","opts","uri","level","options","serverSelectionTimeoutMS","client","MongoClient","db","collection","log","info","callback","connect","insertOne","message","metadata","setImmediate","emit","error","console","code","stack","close"],"sources":["../../src/transports/mongodb.js"],"sourcesContent":["import Transport from \"winston-transport\";\nimport { MongoClient } from \"mongodb\";\n\nmodule.exports = class MongoTransport extends Transport {\n  constructor(opts) {\n    super(opts);\n    const { uri = \"mongodb://localhost:27017\", level, options = {} } = opts;\n    if (!options?.serverSelectionTimeoutMS)\n      options.serverSelectionTimeoutMS = 5000;\n    this.client = new MongoClient(uri, options);\n    this.db = this.client.db(\"test\");\n    this.collection = this.db.collection(\"log\");\n  }\n\n  async log(info, callback) {\n    try {\n      await this.client.connect();\n      await this.collection.insertOne({\n        message: info.message,\n        ...info.metadata\n      });\n      setImmediate(() => {\n        this.emit(\"logged\", info);\n      });\n      callback();\n    } catch (error) {\n      console.error({ code: \"LOG_MONGO_ERR\", error: error.stack });\n      this.emit(\"error\", error);\n      callback(error);\n    } finally {\n      await client.close();\n    }\n  }\n};\n"],"mappings":"aAAA,IAAAA,iBAAA,GAAAC,OAAA,sBAA0C,IAAAC,kBAAA,GAAAC,sBAAA,CAAAH,iBAAA;AAC1C,IAAAI,QAAA,GAAAH,OAAA,YAAsC,SAAAE,uBAAAE,GAAA,UAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;;AAEtCG,MAAM,CAACC,OAAO,GAAG,MAAMC,cAAc,SAASC,0BAAS,CAAC;EACtDC,WAAWA,CAACC,IAAI,EAAE;IAChB,KAAK,CAACA,IAAI,CAAC;IACX,MAAM,EAAEC,GAAG,GAAG,2BAA2B,EAAEC,KAAK,EAAEC,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC,GAAGH,IAAI;IACvE,IAAI,CAACG,OAAO,EAAEC,wBAAwB;IACpCD,OAAO,CAACC,wBAAwB,GAAG,IAAI;IACzC,IAAI,CAACC,MAAM,GAAG,IAAIC,oBAAW,CAACL,GAAG,EAAEE,OAAO,CAAC;IAC3C,IAAI,CAACI,EAAE,GAAG,IAAI,CAACF,MAAM,CAACE,EAAE,CAAC,MAAM,CAAC;IAChC,IAAI,CAACC,UAAU,GAAG,IAAI,CAACD,EAAE,CAACC,UAAU,CAAC,KAAK,CAAC;EAC7C;;EAEA,MAAMC,GAAGA,CAACC,IAAI,EAAEC,QAAQ,EAAE;IACxB,IAAI;MACF,MAAM,IAAI,CAACN,MAAM,CAACO,OAAO,CAAC,CAAC;MAC3B,MAAM,IAAI,CAACJ,UAAU,CAACK,SAAS,CAAC;QAC9BC,OAAO,EAAEJ,IAAI,CAACI,OAAO;QACrB,GAAGJ,IAAI,CAACK;MACV,CAAC,CAAC;MACFC,YAAY,CAAC,MAAM;QACjB,IAAI,CAACC,IAAI,CAAC,QAAQ,EAAEP,IAAI,CAAC;MAC3B,CAAC,CAAC;MACFC,QAAQ,CAAC,CAAC;IACZ,CAAC,CAAC,OAAOO,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,EAAEE,IAAI,EAAE,eAAe,EAAEF,KAAK,EAAEA,KAAK,CAACG,KAAK,CAAC,CAAC,CAAC;MAC5D,IAAI,CAACJ,IAAI,CAAC,OAAO,EAAEC,KAAK,CAAC;MACzBP,QAAQ,CAACO,KAAK,CAAC;IACjB,CAAC,SAAS;MACR,MAAMb,MAAM,CAACiB,KAAK,CAAC,CAAC;IACtB;EACF;AACF,CAAC"}