{"version":3,"file":"graylog-http.js","names":["_axios","require","_axios2","_interopRequireDefault","obj","__esModule","default","Transport","module","exports","CustomTransport","constructor","opts","uri","timeout","URL","log","info","callback","message","metadata","level","stringifiedMessage","JSON","stringify","res","axios","method","url","data","setImmediate","emit","error","console","cause","stack"],"sources":["../../src/transports/graylog-http.js"],"sourcesContent":["const Transport = require(\"winston-transport\");\nimport axios from \"axios\";\n\nmodule.exports = class CustomTransport extends Transport {\n  constructor(opts) {\n    super(opts);\n    const { uri, timeout = 5000 } = opts;\n    this.uri = new URL(\"/gelf\", uri);\n    this.timeout = timeout;\n  }\n\n  async log(info, callback) {\n    try {\n      const { message, metadata, level = \"info\" } = info;\n\n      const stringifiedMessage =\n        typeof message === \"string\"\n          ? message\n          : JSON.stringify(message, null, 2);\n\n      const res = await axios({\n        method: \"post\",\n        timeout: this.timeout,\n        url: this.uri,\n        data: {\n          message: stringifiedMessage,\n          ...metadata\n        }\n      });\n      setImmediate(() => {\n        this.emit(\"logged\", info);\n      });\n      callback();\n    } catch (error) {\n      console.error(\"GRAYLOG_ERR\", error.cause || error.stack);\n      callback(error);\n    }\n  }\n};\n"],"mappings":";AACA,IAAAA,MAAA,GAAAC,OAAA,UAA0B,IAAAC,OAAA,GAAAC,sBAAA,CAAAH,MAAA,WAAAG,uBAAAC,GAAA,UAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA,IAD1B,MAAMG,SAAS,GAAGN,OAAO,CAAC,mBAAmB,CAAC;;AAG9CO,MAAM,CAACC,OAAO,GAAG,MAAMC,eAAe,SAASH,SAAS,CAAC;EACvDI,WAAWA,CAACC,IAAI,EAAE;IAChB,KAAK,CAACA,IAAI,CAAC;IACX,MAAM,EAAEC,GAAG,EAAEC,OAAO,GAAG,IAAI,CAAC,CAAC,GAAGF,IAAI;IACpC,IAAI,CAACC,GAAG,GAAG,IAAIE,GAAG,CAAC,OAAO,EAAEF,GAAG,CAAC;IAChC,IAAI,CAACC,OAAO,GAAGA,OAAO;EACxB;;EAEA,MAAME,GAAGA,CAACC,IAAI,EAAEC,QAAQ,EAAE;IACxB,IAAI;MACF,MAAM,EAAEC,OAAO,EAAEC,QAAQ,EAAEC,KAAK,GAAG,MAAM,CAAC,CAAC,GAAGJ,IAAI;;MAElD,MAAMK,kBAAkB;MACtB,OAAOH,OAAO,KAAK,QAAQ;MACvBA,OAAO;MACPI,IAAI,CAACC,SAAS,CAACL,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;;MAEtC,MAAMM,GAAG,GAAG,MAAM,IAAAC,eAAK,EAAC;QACtBC,MAAM,EAAE,MAAM;QACdb,OAAO,EAAE,IAAI,CAACA,OAAO;QACrBc,GAAG,EAAE,IAAI,CAACf,GAAG;QACbgB,IAAI,EAAE;UACJV,OAAO,EAAEG,kBAAkB;UAC3B,GAAGF;QACL;MACF,CAAC,CAAC;MACFU,YAAY,CAAC,MAAM;QACjB,IAAI,CAACC,IAAI,CAAC,QAAQ,EAAEd,IAAI,CAAC;MAC3B,CAAC,CAAC;MACFC,QAAQ,CAAC,CAAC;IACZ,CAAC,CAAC,OAAOc,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,aAAa,EAAEA,KAAK,CAACE,KAAK,IAAIF,KAAK,CAACG,KAAK,CAAC;MACxDjB,QAAQ,CAACc,KAAK,CAAC;IACjB;EACF;AACF,CAAC"}